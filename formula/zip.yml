summary: Compression and file packaging/archive utility
web-url: https://infozip.sourceforge.io/Zip.html

version: 3.0-11

src-url: https://downloads.sourceforge.net/project/infozip/Zip%203.x%20%28latest%29/3.0/zip30.tar.gz
src-sha: f0e8bb1f9b7eb0b01285495a2699df3a4b766784c1765a8f1aeedf63c0806369

# https://packages.debian.org/sid/zip
fix-url: https://deb.debian.org/debian/pool/main/z/zip/zip_${PACKAGE_VERSION}.debian.tar.xz
fix-sha: c5c0714a88592f9e02146bfe4a8d26cd9bd97e8d33b1efc8b37784997caa40ed

dep-upp: patch
bsystem: make
binbstd: yes

prepare: |
    tar xf $PACKAGE_FIX_PATH -C "$SOURCE_DIR" || return 1
    while read patch
    do
        patch -p1 < "debian/patches/$patch" || return 1
    done < debian/patches/series
    sed_in_place 's|$(AS) _match.s|$(AS) -o _match.o _match.s|'          unix/Makefile &&
    sed_in_place 's|$(AS) _crc_i386.s|$(AS) -o _crc_i386.o _crc_i386.s|' unix/Makefile &&
    sed_in_place '/-DNO_/c :' unix/configure &&
    inject_stub_system zip.c

install: |
    makew -f unix/Makefile clean &&
    makew -f unix/Makefile generic \
        CC="'$CC $CFLAGS $CPPFLAGS -include string.h'" \
        CPP="'$CPP'" \
        AS="$AS" \
        AR="$AR" &&
    makew -f unix/Makefile install \
        prefix="$TARGET_INSTALL_DIR" \
        MANDIR="$TARGET_INSTALL_DIR/share/man/man1"
